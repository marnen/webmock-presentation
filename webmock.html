<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>Testing Remote Services with WebMock</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" media="screen, projection, print" href="http://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css"> 
    <script src="http://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js" charset="utf-8" type="text/javascript"></script>
    <link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css">
    <link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css">
    <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
    <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shAutoloader.js" type="text/javascript"></script>
    <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushRuby.js" type="text/javascript"></script>
    <script type="text/javascript">SyntaxHighlighter.all()</script>
  </head>
  <body>
    <div class="slide cover">
      <h1>Testing Remote Services with WebMock</h1>
      <p>Marnen E. Laibow-Koser</p>
      <p>September 2010</p>
    </div>
    <div class="slide">
      <h1>Why do we need it?</h1>
      <ul>
        <li>Many Web applications call remote services</li>
        <li>Good testing practice requires us to test these calls</li>
      </ul>
    </div>
    
    <div class="slide">
      <h1>How do we test this code?</h1>
      <pre class="brush: ruby">class Twitter
  include HTTParty
  
  def self.user_info(username, format = :json)
    get "http://api.twitter.com/1/users/show/#{username}.#{format}"
  end
end</pre>
      <h2>The obvious approach</h2>
      <p>Call the external service and make sure we’re processing the result</p>
      <pre class="brush: ruby">describe Twitter do
  describe "user_info" do
    it "should get extended user information" do
      Twitter.user_info('marnen')['name'].should == "Marnen Laibow-Koser"
    end
  end
end</pre>
      <p class="wrong">WRONG!</p>
    </div>
    
    <div class="slide">
      <h1>What’s the matter with this?</h1>
      <pre class="brush: ruby">describe Twitter do
  describe "user_info" do
    it "should get extended user information" do
      Twitter.user_info('marnen')['name'].should == "Marnen Laibow-Koser"
    end
  end
end</pre>
      <ul>
        <li>Unit tests should test code in relative isolation</li>
        <li>It tests the remote service, not our code</li>
        <li>If our service call has side effects, testing is difficult</li>
        <li>If the network is down, the test will fail</li>
        <li>Calling external services slows our tests down</li>
      </ul>
    </div>
  </body>
</html>